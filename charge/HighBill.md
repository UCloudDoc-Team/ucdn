# 高额账单风险警示


当您的域名正在被恶意攻击或者被恶意盗刷时，会产生突发高带宽以及大流量消耗，导致产生高于日常消费金额的高额账单。

因恶意攻击和流量盗刷产生的高额账单无法免除/退款，为尽量避免此类风险，本文为您介绍这一类情况的应对办法。

## 恶意访问带来高额账单

客户流量被恶意盗刷而产生突发带宽增高的情况与被攻击的情况类似，因为实际消耗了CDN的带宽资源，所以您需要自行承担攻击产生的流量带宽费用。

域名被恶意攻击或者流量被恶意盗刷的情况下，将导致出现高额账单，且账单金额会超出您的账户余额。

CDN产品属于按量付费产品，其账单金额受计费周期（如按天出账、按月出账等）和账单处理时延等因素的影响，无法做到账户余额为0或者剩余流量为0的情况下立即停机，因而可能会出现欠费金额大于0，或者单条账单的欠费金额直接超出您的额度范围。

## 应对办法

UCDN产品默认并不提供访问控制或者安全防护能力，UCDN会对客户带宽突增情况进行检测，如发现异常流量，则会针对异常流量带来的针对业务服务整体负载情况来评估是否对突发流量域名进行封禁并且通知客户来保障全网用户的稳定性，由此导致的可用性问题，Ucloud不承担责任。

## 为保障服务的正常运行和避免出现高额账单，建议参考本文档开启防护功能或者对流量进行相应的访问控制。

### 添加Umon通知

用户可在UCDN域名配置下通过绑定监控任务，针对域名进行带宽峰值、以及当天累计总流量进行监控，若超过定值，则会通过Umon发送通知。
具体操作，可参考[CDN域名告警模板配置](/ucdn/domain/config/Basic?id=%e5%91%8a%e8%ad%a6%e6%a8%a1%e6%9d%bf%e9%85%8d%e7%bd%ae)或者[Umon监控配置](https://docs.ucloud.cn/umon/template)

![image](https://github.com/user-attachments/assets/259f7081-6d6c-4ffb-8fd2-04d4463519ab)

![image](https://github.com/user-attachments/assets/ee29931d-a544-439c-910b-b38698919089)


### 配置访问控制

#### 在出现异常流量突增的时候，建议您先通过分析日志，来判断当前是由于什么原因产生的带宽突增，然后根据具体的原因为域名针对性的以下访问控制功能，以避免产生不必要的流量带宽消耗。

1.控制台配置：IP、referer黑名单。配置参考[访问控制](/ucdn/domain/config/control)

2.非标配置：
* UA黑白名单：对用户请求的User-Agent头进行限制，仅允许/禁止指定 User-Agent 的请求访问CDN域名。
* 时间戳防盗链：可参考时间戳防盗链,若有其他防盗链策略也可评估确认支持情况。


#### 若您无法定位攻击的来源和规律，需要进行后续流量进行控制，可参考以下策略。

1.带宽封顶：通过对域名进行带宽峰值限制，来控制成本或者防止攻击影响线上服务，一般来说限制策略有：
  A.设置带宽峰值阈值为XXX (Mbps)，对于超过阈值之后的请求进行单链接限速Y（MB/s），这种限制并不能将峰值完全限制在XXX值，会根据单链接限速的大小和请求数进行累计
  B.设置带宽峰值阈值为XXX (Mbps)，对于超过阈值之后的请求进行403封禁。

2.单链接限速：针对单次请求限速XX MB/S (也可以设置KB/s,B/s;GB/s以上不建议设置，限速效果不明显)。

3.IP访问频次限制：针对单IP在单位时间内，限制访问次数，超过则设置一个时间段内返回403。配置策略为：域名/指定目录/URL在X分钟内收到ip的访问超过X次，则在接下来的X秒/分钟/小时内，达到阈值的IP再次访问该域名或者目录或者URL就会被拒绝（403）。

#### 若发现攻击带宽/流量较大，为避免攻击导致源站/服务器故障，建议您暂时封停域名解析，或者使用高防产品。




