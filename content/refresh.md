# 内容刷新

### 为什么需要刷新？ ### 

源站更新文件后，UCDN不会主动回源拉取最新的文件，需要手动刷新UCDN缓存，触发UCDN节点回源，请求新文件，或者回源校验文件是否需要更新。

一般源站有文件更新时，您可以通过内容刷新，来保证用户获取到最新文件。

内容刷新包括：<strong>文件刷新和目录刷新</strong>

单域名默认刷新上限：文件刷新：<strong>700条/天   目录刷新:20条/天</strong>；若需添加刷新上限，请联系技术支持处理。

刷新生效时间：单任务刷新全网生效时间在1分钟左右，如果刷新任务较多，会导致刷新任务排队，请耐心等待，若遇到刷新失败，或者单个刷新任务卡住超过10分钟的情况，请联系技术支持处理。

**目录刷新**

1） 必须以http(s)://开头，以/结尾；建议使用http:// 开头，默认http和https共用缓存，所以当刷新http协议文件时，会一起刷新https的协议文件。

2） 请注意区分url中的字母的大小写，错误的大小写会导致刷新无效，不支持通配符或者正则输入。

3） 如果目录有上下级层次关系，本功能会自动同时推送下级子目录，不需要填写下级子目录。

4） 使用目录刷新，目录下文件会<strong>置为缓存过期</strong>，刷新之后，当用户访问匹配目录下资源时，会对比源站的<strong> Last-Modify 和etag </strong>头部信息，若与节点缓存资源一致，则直接返回已缓存资源，若不一致，则重新回源拉取资源并重新缓存。

5） 注意：如果源站更新内容较多，目录刷新后会出现大量回源现象，请谨慎操作。

**文件刷新**

1） 必须以http(s)://开头，填写完整的路径，如 http://static.ucloud.cn/images/test.jpg  ；建议使用http:// 开头，默认http和https共用缓存，所以当刷新http协议文件时，会一起刷新https协议的文件。

2） 请注意区分url中的字母的大小写，错误的大小写会导致刷新无效，不支持通配符或者正则输入。

3） 一次最多提交<strong>30条</strong>url，一行一条

4） <strong>删除</strong> CDN 所有节点上对应资源的缓存，下一次用户请求过来时回源拉取新的文件。

注意：

* 目录和文件如果同时填写，会同时提交目录和文件中填写的内容。内容刷新的记录和状态可在性能中进行查看。

* 大文件下载和点播的内容刷新不允许输入中文，中文经过转码也不支持。 而网页加速的内容刷新允许输入中文，但是如果中文经过转码则会失败。

* 目录删除：适用场景——适用于客户源站文件变更了，但是last-modified和etag头部没有变化，目录下文件特别多域名整体没什么量的场景；目前不支持控制台操作目录下文件缓存删除，如有需求，请联系技术支持处理。
* 若希望用户端是访问到最新的资源，操作顺序应该是源站先更新资源，然后再进行CDN刷新操作。否则用户端还可能继续访问到旧资源。

相关API文档：

获取域名刷新任务状态：[DescribeNewUcdnRefreshCacheTask](api/ucdn-api/describe_new_ucdn_refresh_cache_task)

刷新缓存：[RefreshNewUcdnDomainCache](api/ucdn-api/refresh_new_ucdn_domain_cache)

#### 操作步骤：

![image-20200304155547223](../images/image-20200304155547223.png)

![image-20200304155634104](../images/image-20200304155634104.png)

### 相关问题：

1. 域名间共用缓存刷新：URL刷新任意URL，则A域名和B域名对应的资源都会刷新；目录刷新根据key域名刷新，如果配置的是B域名共用缓存A域名，若需要推送A域名和B域名的缓存，则需要推送A域名的目录即可。
2. 域名配置时间戳防盗链的内容刷新：刷新不带参数的URL/目录即可。
3. 域名配置了缓存改写的内容刷新：需要刷新改写后的URL/目录。
4. 泛域名不支持直接刷新，需要通过具体的域名做刷新。
