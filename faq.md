# FAQ



## 1. cdn预取的流量怎么算的？

CDN预取产生的流量或者带宽不计入收费的流量或者带宽峰值中。

## 2. <http://www.xxx.com/abc.jpg> 和 <http://www.xxx.com/abc.jpg?t=xxx> 是否判定为2个不同的文件？

是的。cdn缓存完全是根据完整的url来的，有任何的不同都会判断为不同的文件。

## 3. 页面加速、大文件加速、视频点播加速有什么区别？该如何选择？

区别：面向的加速内容不同，页面加速主要针对网页文件、图片文件等小文件，大文件加速主要针对安装包，压缩包等大文件，视频加速主要针对MP4等视频文件

选择：一般文件大于5M，建议接入大文件平台，若为视频类文件，选择点播加速

## 4. PHP等动态的网站可以缓存么？

不可以，只能透传。动态内容一般需要读取数据库，不能缓存，暂不支持动态加速

## 5. 如何判断用户访问的是CDN节点还是回源的？

可以chrome打开网页，选择工具，开发者工具，刷新网页，找到加速域名下的文件。如果缓存，那么就是显示hit，如果没有缓存到，就会显示miss。

![](/images/faq1.jpg)

## 6. 手动刷新是否指CDN服务器上的文件已经是最新的了？

不是，手动刷新是指把CDN上的缓存文件删掉，再一次有请求时CDN节点会回源拉取文件。

## 7. 我们网站内容更新了，但为什么打开页面后还是旧的内容？

在使用CDN加速后，文件会在CDN节点上进行缓存。由于缓存时间未到期，可能导致文件或页面更新后用户访问到的页面仍是旧的页面。一般建议在发生网站内容更新的时候对相应内容进行刷新。

## 8. 可以单个文件刷新吗？

可以刷新单个文件，刷新单个文件输入文件URL即可，刷新包含目录刷新、单个文件刷新

## 9. 为什么我同一个ip同一个dns经常会解析出来不同的访问ip？

几个覆盖比较好的节点会轮询解析，所以会出现访问不一样的ip。


## 10. 为何首次访问网站的效果不好不明显？

CDN服务节点在没缓存情况下，中间一公里是通过机房的骨干网络回源，速度对比源站还是有所提升，只是缓存下来后效果更明显。

## 11 如何获取最终用户IP？

正式切换使用CDN服务后，由于所有的用户请求都会通过节点，因此贵司服务器实际收到请求为CDN节点所发起的请求，故无法依照之前的方式获取最终用户IP地址，如果贵司需要获取最终用户IP，则可根据贵司网站编写的脚本语言自行选择下列代码。另外，需要注意的是以下代码需要在切换后才能正式生效，如未切换则可能导致获取IP错误。
:

PHP: :

    $user_IP ($_SERVER["HTTP_X_REAL_IP"]);

ASP: :

    <% Request.ServerVariables("HTTP_X-Real-IP") %>

Java: :

    String srcIp request.getHeader("X-Real-IP");

C\#: :

``` 
String srcIp Request.Headers["X-Real-IP"]; 
```

Asp.net:

如贵司用ServerVariables来获取参数，因为ServerVariables有编码解码的过程，因此应该用HTTP\_Cdn\_Src\_Ip来获取变量，如:
:

``` 
result HttpContext.Current.Request.ServerVariables["HTTP_X-Real-IP"]; 
```

## 12. 如何初步定位CDN故障原因？

1.打开hosts文件，hosts文件一般存放在：c:windowssystem32driversetc目录下

2.添加源IP及对应的故障域名。(如192.168.11.11 www.abc.com，两者之间有空格，且IP在前)

3.保存hosts文件修改，并重启浏览器，访问域名，查看是否访问仍然有问题，若仍有问题，则为源站故障，若访问正常，请及时联系UCloud技术支持。

## 13. 下载加速服务做301跳转后是否会产生影响？

基本上不会有影响，只要贵司下载器支持标准的http协议，就能支持这样的跳转。目前大部分通用下载器是可以支持的。

## 14. 创建网页加速时，默认的缓存配置规则是什么？

默认情况下，php、aspx、asp、jsp、do、dwr、cgi、fcgi、action、ashx、axd、json
等动态文件不缓存，shtml、html、htm、js 类型默认缓存1天，其他类型的静态文件默认缓存半天。

## 15. 如何配置网页加速、大文件和点播加速的防盗链？

支持MD5防盗链，用户需提供指定秘钥，同步技术支持进行配置

k = substr(md5(密钥 + 文件URI + 过期时间 t),8,16)

1.k， URL 中参数名，substr(md5(串值),8,16)， md5 生成的串是 32 位，取出中间的 16 位作为参数 k 的值

2.t， 过期时间，如当前是 2012-04-23 16:20:00 设置有效时长 2 小时，即失效时间为2012-04-23 18:20:00
换算成基于 1970 年的秒数为 1335176400，即参数 t 的值

3.密钥， 协商好的字符串.

举例： URL：<http://tysxtest.ufile.ucloud.com.cn/test/3e2_teacher_720p.mp4>

key :如 whaty321

t：如2019-07-01 12:00过期，转换后t=1561953600

k=substr(md5(whaty321/test/3e2\_teacher\_720p.mp41561953600))=substr(1100bda530528404109eaa80bd9fb9d8,8,16)=30528404109eaa80

添加防盗链后的URL为：<http://tysxtest.ufile.ucloud.com.cn/test/3e2_teacher_720p.mp4?k=30528404109eaa80.&t=1561953600>

使用防盗链的URL能够进行正常访问，如果k对应不上则访问失效，如果校验发现t的时间已经超过有效时长，校验也会失败。

## 16. 访问的CDN节点ip与用户所在地/供应商为什么不匹配，比如广东电信用户访问到了江苏电信的ip？

静态加速是采用local dns调度的模式，所以客户访问被调度到哪个地区、运营商，这取决于用户配置的local
dns。很多情况下，客户都使用了默认的dns：114.114.114.114，但是这个dns并不能覆盖所有的地区和运营商，会导致很多地区的调度会有问题。这里推荐使用客户本地本运营商的local
dns，或者使用dnspod的dns ip：119.29.29.29。

## 17. CDN获取到的内容和源站不一致怎么办？

刷新CDN资源

## 18. CDN添加加速域名以ufile为源站时，为什么访问资源会返回400？

加速域名是自己的域名，源站是ufile域名的情况，需要提交工单给UFILE配置UCDN加速域名的白名单。比如客户创建了一个域名www.abc.com，源站是ufile的bucket
abc.ufile.ucloud.cn，这时需要提交ufile工单，将www.abc.com加入bucket
abc.ufile.ucloud.cn的白名单。

## 19. 使用CDN加速，源站为阿里云云主机，出现5xx情况怎么办？

在CDN加速和源站均无异常情况下，可能为阿里云云主机云盾限制回源请求，需将CDN回源节点加入到云盾的白名单中，回源节点信息可联系技术支持获取。
